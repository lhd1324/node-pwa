export default {
  name: 'listnav',
  data(){
  	return {
  		grouplist:[],
  		userlist:[],
  		curgroupid:"",
  		userinfo:{}
  	}
  },
  created(){
  	//console.log(this.$parent.userinfo);
  	//this.userinfo=this.$parent.userinfo
  	this.getgrouplist();
  	this.getuserlist();
  },
  mounted(){
  	console.log(this.$parent.userinfo);
  },
  watch:{
  	curgroupid(){
  		console.log(this.curgroupid)
  		this.getuserlist(this.curgroupid);
  	}
  },
  methods:{
  	getgrouplist(id){
		let that = this;
		this.$root.createxhr({
			url:"/searchgrouplist/",
			data:{
				groupid:id
			},
			type:"post",
			success(res){
				console.log(res)
				if(res.succ){
					that.grouplist=res.data.data;
					console.log(that.grouplist)
				}
			},
			error(data){
				console.log(data)
			}
		});
	},
	getuserlist(id){
		let that = this;
		if(!id){
			id=""
		}
		this.$root.createxhr({
			url:"/searchuserlist/",
			data:{
				groupid:id
			},
			type:"post",
			success(res){
				console.log(res)
				if(res.succ){
					for(let i=0;i<res.data.data.length;i++){
						for(let j=0;j<that.grouplist.length;j++){
							if(res.data.data[i].groupid==that.grouplist[j]._id){
								res.data.data[i].groupname=that.grouplist[j].groupname;
							}
						}
					}
					that.userlist=res.data.data;
					console.log(that.userlist);
				}
			},
			error(data){
				console.log(data)
			}
		});
	},
	setadmin(ele,val){
		let that = this;
		this.$root.createxhr({
			url:"/setadmin/",
			data:{
				id:ele._id,
				status:val
			},
			type:"post",
			success(res){
				console.log(res)
				if(res.succ){
					that.getuserlist(that.curgroupid);
				}
			},
			error(data){
				console.log(data)
			}
		});
	},
	exitadmin(){
		this.$root.createxhr({
			url:"/setadmin/",
			data:{
				id:ele._id,
				status:1
			},
			type:"post",
			success(res){
				console.log(res)
				if(res.succ){
					that.getuserlist(that.curgroupid);
				}
			},
			error(data){
				console.log(data)
			}
		});
	}
  }
}
